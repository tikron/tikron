# ###############################################
# Custom configuration
# ###############################################

# Allow access to developement workspace
<Directory "D:/Benutzer/Titus/Documents/Entwicklung/Java">
	AllowOverride None
	Order allow,deny
	Allow from all
</Directory>

# Expire static content (Otherwise Firefox doesn't recognise updated files)
<IfModule mod_expires.c>
	ExpiresActive On
###	ExpiresDefault "access plus 5 minutes"
	ExpiresByType text/css "access plus 5 minutes"
	ExpiresByType application/javascript "access plus 5 minutes"
	ExpiresByType image/gif "access plus 5 minutes"
	ExpiresByType image/jpg "access plus 5 minutes"
	ExpiresByType image/png "access plus 5 minutes"
	FileETag MTime Size
</IfModule>

# Cache root
<Directory "C:/ProgramData/Apache/httpd/cache">
	AllowOverride None
	Order allow,deny
	Allow from all
</Directory>

# Caching
<IfModule mod_cache.c>
<IfModule mod_disk_cache.c>
	CacheRoot "C:/ProgramData/Apache/httpd/cache"
	CacheEnable disk /ibase
	CacheDirLevels 5
	CacheDirLength 3
	CacheIgnoreCacheControl On
</IfModule>
</IfModule>

# Create WebDAV database
<IfModule dav_module.c>
	DAVLockDB "C:/ProgramData/Apache/httpd/DAVLock"
</IfModule>


#
# Use name-based virtual hosting.
#
NameVirtualHost *:80

#
# Tikron
#
<VirtualHost *:80>
	ServerName tikron
	ServerAlias www.tikron
	ServerAdmin admin@localhost
	DocumentRoot "D:/Benutzer/Titus/Documents/Entwicklung/Java/Git/tikron-site/tikron-site-static/httpdocs/"
	ErrorLog logs/tikron-error.log
	CustomLog logs/tikron-access.log common

<IfModule mod_jk.c>
	JkMount /webapp/* lb1
	JkMount /webman/* lb1
	JkMount /ibase/* lb1
</IfModule>

<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteLog "logs/tikron-rewrite.log" 
	RewriteLogLevel 0
	# Homepage
	RewriteRule ^/(index\.html)?$ /webapp/displayHomepage.html [P,L]
	# Deeplinks
	RewriteRule ^/reisen$         /webapp/g/reisen,1.html [P,L]
	RewriteRule ^/kroatien$       /webapp/c/kroatien,1.html [P,L]
	RewriteRule ^/schweden$       /webapp/c/schweden,14.html [P,L]
	RewriteRule ^/polen$          /webapp/c/polen,16.html [P,L]
	RewriteRule ^/events$         /webapp/g/events,2.html [P,L]
	RewriteRule ^/tractor\-pulling$ /webapp/c/tractor-pulling,9.html [P,L]
	RewriteRule ^/goa\-trance$    /webapp/c/open-air,7.html [P,L]
	RewriteRule ^/natur$          /webapp/c/natur,2.html [P,L]
	RewriteRule ^/technik$        /webapp/c/technik,6.html [P,L]
	RewriteRule ^/kurzfilme$      /webapp/kurzfilme.html [P,L]
	RewriteRule ^/surftipps$      /webapp/surftipps.html [P,L]
	# Before Reconstruction Jan 2015
	RewriteRule ^/webapp/c/neue\-bilder\,1\.html$ /webapp/c/kroatien,1.html [R=301,L]
	RewriteRule ^/webapp/c/winter\,3\.html$ /webapp/c/natur,2.html [R=301,L]
	RewriteRule ^/webapp/c/architektur\,4\.html$ /webapp/c/technik,6.html [R=301,L]
	RewriteRule ^/webapp/goa\-trance\.html$ /webapp/g/events,2.html [R=301,L]
	# Before Dynamic Reports Apr 2015
	RewriteRule ^/webapp/t/einmal\-um\-die\-ostsee.html$ /webapp/t/einmal-um-die-ostsee,17.html [R=301,L]
	# Maintenance
#		RewriteCond %{REMOTE_ADDR} ^79\.211\.86\.180$
#		RewriteRule ^(.*)$ - [F]
</IfModule>
</VirtualHost>

#
# Subdomain for Image Server
#
<VirtualHost *:80>
	ServerName images.tikron
	ServerAdmin admin@localhost
	DocumentRoot "D:/Benutzer/Titus/Documents/Entwicklung/Java/Git/tikron-site/tikron-site-static/subdomains/images"
	ErrorLog logs/tikron-images-error.log
	CustomLog logs/tikron-images-access.log common

# Restrict source image requests by HTTP basic authentication with user and password
<LocationMatch ".*(getSourceImage|putSourceImage|removeSourceImage|renameSourceImage)\.jsp">
	AuthType Basic
	AuthName "Authentication Required"
	AuthUserFile "D:/Benutzer/Titus/Documents/Entwicklung/Java/Git/tikron-site/tikron-site-static/subdomains/images/.htpasswd"
	Require valid-user
	Order allow,deny
	Allow from all
</LocationMatch>

<IfModule mod_jk.c>
	JkMount /ibase/* lb1
</IfModule>

# Convert image URL to image server request with name parameter
<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteLog "logs/tikron-images-rewrite.log" 
	RewriteLogLevel 0
	RewriteCond %{QUERY_STRING} ^template=(.*)$
	RewriteRule ^/(.*\.(gif|jpg|png))$ /ibase/getImage.jsp?name=/$1&template=%1 [P,L]
</IfModule>
</VirtualHost>

#
# Subdomain for Files
#
<VirtualHost *:80>
	ServerName files.tikron
	ServerAdmin admin@localhost
	DocumentRoot "D:/Benutzer/Titus/Documents/Entwicklung/Java/Git/tikron-site/tikron-site-static/subdomains/files"
	ErrorLog logs/tikron-files-error.log
	CustomLog logs/tikron-files-access.log common

#    <Location "/share">
#      DAV On
#      AllowOverride FileInfo AuthConfig Limit
#      Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
#      <Limit GET POST OPTIONS PROPFIND PUT>
#          Order allow,deny
#          Allow from all
#      </Limit>
#      <LimitExcept GET POST OPTIONS PROPFIND PUT>
#          Order deny,allow
#          Deny from all
#      </LimitExcept>
#    </Location>
</VirtualHost>

#
# TK
#
<VirtualHost *:80>
	ServerName tituskruse
	ServerAlias www.tituskruse
	ServerAdmin admin@localhost
	DocumentRoot "D:/Benutzer/Titus/Documents/Entwicklung/Java/Git/tk/tk-static/httpdocs/"
	ErrorLog logs/tk-error.log
	CustomLog logs/tk-access.log common

<IfModule mod_jk.c>
	JkMount /tk-webapp/* lb1
</IfModule>

<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteLog "logs/tk-rewrite.log" 
	RewriteLogLevel 0
	# Homepage
	RewriteRule ^/(index\.html)?$ /tk-webapp/jsp/index.jsp [P,L]
	# Translate from HTML to JSPs
	RewriteRule ^/([A-Za-z0-9\-_]+)\.html$ /tk-webapp/jsp/$1.jsp [P,L]
</IfModule>
</VirtualHost>


